<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="../api-view-model-transformer.html">
  </head>
  <body>

    <test-fixture id="basic">
      <template>
        <api-view-model-transformer></api-view-model-transformer>
      </template>
    </test-fixture>

    <script>
    /* global fixture, assert */
    suite('_expandSchema()', () => {
      let context;
      let model;
      let element;
      setup(function() {
        element = fixture('basic');
        context = {
          file: 'file://raml-examples/raml-headers/api.raml',
          doc: 'http://raml.org/vocabularies/document',
          shacl: 'http://www.w3.org/ns/shacl',
          shapes: 'http://raml.org/vocabularies/shapes'
        };
        model = [{
          '@id': 'file://raml-examples/raml-headers/api.raml',
          '@type': [
            'doc:#Document',
            'doc:#Fragment',
            'doc:#Module',
            'doc:#Unit'
          ],
          'doc:#declares': [{
            '@id': 'file:#/declarations/ExampleType',
          }]
        }];
      });

      test('Returns a promise', () => {
        const result = element._expandSchema(model, context);
        assert.typeOf(result.then, 'function');
        return result;
      });

      test('Returns expanded model', () => {
        return element._expandSchema(model, context)
        .then((result) => {
          assert.typeOf(result, 'array', 'Result is an array');
          assert.isUndefined(result['@context'], 'Context is removed');
        });
      });

      test('Properties are expanded', () => {
        return element._expandSchema(model, context)
        .then((result) => {
          result = result[0];
          const type = result['@type'];
          assert.equal(type[0], 'http://raml.org/vocabularies/document#Document');
          assert.equal(type[1], 'http://raml.org/vocabularies/document#Fragment');
          assert.equal(type[2], 'http://raml.org/vocabularies/document#Module');
          assert.equal(type[3], 'http://raml.org/vocabularies/document#Unit');
          const dcl = result['http://raml.org/vocabularies/document#declares'];
          assert.typeOf(dcl, 'array');
          assert.equal(dcl[0]['@id'], 'file://raml-examples/raml-headers/api.raml#/declarations/ExampleType');
        });
      });
    });
    </script>

  </body>
</html>
